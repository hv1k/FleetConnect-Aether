<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script>
      // Theme init - prevent flash of wrong theme
      (function(){
        var t = localStorage.getItem('fleetconnect-theme');
        if(t === 'light') document.documentElement.classList.add('light-mode');
      })();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alert Settings | FleetConnect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-dark: #100e20;
            --bg-card: #181530;
            --bg-input: #14112a;
            --bg-hover: #333;
            --border: #2a2550;
            --text-primary: #ede9fe;
            --text-secondary: #888;
            --text-muted: #666;
            --accent: #8b5cf6;
            --accent-glow: rgba(139, 92, 246, 0.3);
            --accent-blue: #8b5cf6;
            --warning: #fbbf24;
            --error: #f87171;
            --success: #34d399;
            --admin: #8b5cf6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #100e20; color: #ede9fe; min-height: 100vh; display: flex; }

        .dark .sidebar { background: #ffffff; border-color: #e8e4dc; }
        .layout { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar { width: 240px; background: #181530; border-right: 1px solid #333; padding: 24px 16px; position: fixed; left: 0; height: 100vh; z-index: 100; display: flex; flex-direction: column; }
        .sidebar-header { display: flex; align-items: center; gap: 10px; margin-bottom: 32px; padding: 20px 20px 12px; }
        .sidebar-logo { font-size: 1.2rem; font-weight: 700; color: #8b5cf6; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; color: #666; padding: 0 12px; margin-bottom: 8px; letter-spacing: 0.5px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; color: #8b85b0; text-decoration: none; font-size: 0.85rem; font-weight: 500; transition: all 0.2s; cursor: pointer; }
        .nav-item:hover { background: #333; color: #ede9fe; }
        .nav-item.active { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .nav-item svg { width: 20px; height: 20px; }

        .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid #333; }
        .user-menu { display: flex; align-items: center; gap: 12px; padding: 12px; background: #333; border-radius: 10px; }
        .user-avatar { width: 34px; height: 34px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #7c3aed); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 0.85rem; }
        .user-name { font-size: 0.85rem; font-weight: 600; color: #ede9fe; }
        .user-role { font-size: 0.7rem; color: #888; }
        .user-info { flex: 1; min-width: 0; }
        .logout-btn { background: none; border: none; color: #888; cursor: pointer; padding: 6px; border-radius: 6px; }
        .logout-btn:hover { background: #444; color: #ede9fe; }

        /* Main */
        .main { margin-left: 240px; flex: 1; min-height: 100vh; }
        .header { background: #181530; padding: 20px 32px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .header h1 { font-size: 1.4rem; font-weight: 700; color: #ede9fe; }
        .content { padding: 32px; max-width: 1000px; }

        /* Alert Card */
        .alert-card { background: #181530; border-radius: 16px; border: 1px solid #333; padding: 24px; margin-bottom: 20px; }
        .alert-header { display: flex; align-items: start; gap: 16px; margin-bottom: 20px; }
        .alert-icon { font-size: 2rem; }
        .alert-info { flex: 1; }
        .alert-title { font-size: 1rem; font-weight: 600; color: #ede9fe; margin-bottom: 4px; }
        .alert-description { font-size: 0.85rem; color: #888; }

        /* Toggle Switch */
        .toggle-switch { display: inline-flex; align-items: center; cursor: pointer; }
        .toggle-slider { width: 44px; height: 24px; background: #444; border-radius: 12px; position: relative; transition: background 0.2s; margin-left: 12px; }
        .toggle-slider::after { content: ''; position: absolute; width: 20px; height: 20px; background: #ede9fe; border-radius: 50%; top: 2px; left: 2px; transition: 0.2s; }
        .toggle-switch.active .toggle-slider { background: #8b5cf6; }
        .toggle-switch.active .toggle-slider::after { left: 22px; }

        /* Config Section */
        .config-section { padding: 20px; background: #14112a; border-radius: 10px; margin-top: 16px; border: 1px solid #333; }
        .config-title { font-size: 0.85rem; font-weight: 600; color: #ede9fe; margin-bottom: 12px; }

        /* Form */
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 0.8rem; font-weight: 500; color: #999; margin-bottom: 6px; }
        .form-group input, .form-group select { width: 100%; padding: 10px 12px; font-family: inherit; font-size: 0.85rem; background: #14112a; border: 1px solid #444; border-radius: 8px; color: #ede9fe; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #8b5cf6; }

        /* Checkboxes */
        .checkbox-group { margin-top: 12px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
        .checkbox-item input[type="checkbox"] { cursor: pointer; }
        .checkbox-item label { margin: 0; cursor: pointer; font-size: 0.85rem; color: #ede9fe; }

        /* Buttons */
        .button-group { display: flex; gap: 12px; margin-top: 24px; flex-wrap: wrap; }
        .btn { padding: 12px 24px; border-radius: 10px; font-size: 0.9rem; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; }
        .btn-primary { background: #8b5cf6; color: #fff; }
        .btn-primary:hover { background: #7c3aed; }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { background: #333; color: #ede9fe; border: 1px solid #444; }
        .btn-secondary:hover { background: #444; }

        /* Success Message */
        .success-message { display: none; padding: 16px; background: rgba(34, 197, 94, 0.1); border: 1px solid #34d399; border-radius: 10px; color: #34d399; margin-bottom: 20px; font-size: 0.9rem; }
        .success-message.show { display: block; }

        .mobile-toggle { display: none; width: 40px; height: 40px; border: 1px solid #444; border-radius: 8px; background: #14112a; color: #ede9fe; align-items: center; justify-content: center; cursor: pointer; }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .sidebar.open { display: flex; position: fixed; z-index: 100; }
            .main { margin-left: 0; }
            .mobile-toggle { display: flex; }
            .content { padding: 16px 20px; }
            .header { padding: 16px 20px; }
        }
    
        /* Light Mode */
        .light-mode { --bg-dark: #f5f5f5; --bg-card: #ffffff; --bg-input: #e8e8e8; --bg-hover: #e8e8e8; --border: #d0d0d0; --text-primary: #100e20; --text-secondary: #555555; --text-muted: #888888; }
        .light-mode .sidebar, .light-mode .admin-sidebar { background: #ffffff !important; border-color: #d0d0d0 !important; }
        .light-mode .sidebar-logo, .light-mode .admin-sidebar-logo { color: #7c3aed !important; }
        .light-mode .nav-item, .light-mode .admin-nav-item { color: #555555 !important; }
        .light-mode .nav-item:hover, .light-mode .admin-nav-item:hover { background: #e8e8e8 !important; color: #100e20 !important; }
        .light-mode .nav-item.active, .light-mode .admin-nav-item.active { background: rgba(139, 92, 246, 0.15) !important; color: #7c3aed !important; }
        .light-mode .nav-section-title, .light-mode .admin-nav-section { color: #888888 !important; }
        .light-mode .user-menu { background: #e8e8e8 !important; }
        .light-mode .user-name { color: #100e20 !important; }
        .light-mode .header { background: #ffffff !important; border-color: #d0d0d0 !important; }
        .light-mode .header h1 { color: #100e20 !important; }
        .light-mode .header-subtitle { color: #555555 !important; }
        .light-mode .main, .light-mode .content, .light-mode .admin-main { background: #f5f5f5 !important; }
        .light-mode .card, .light-mode .stat-card, .light-mode .metric-card, .light-mode .admin-card { background: #ffffff !important; border-color: #d0d0d0 !important; }
        .light-mode .card-title, .light-mode .stat-label { color: #100e20 !important; }
        .light-mode .card-subtitle { color: #555555 !important; }
        .light-mode input, .light-mode textarea, .light-mode select { background: #e8e8e8 !important; border-color: #d0d0d0 !important; color: #100e20 !important; }
        .light-mode input::placeholder, .light-mode textarea::placeholder { color: #888888 !important; }
        .light-mode .form-label, .light-mode label { color: #100e20 !important; }
        .light-mode .badge { background: rgba(139, 92, 246, 0.15) !important; color: #7c3aed !important; }
        .light-mode .btn-secondary { background: #e8e8e8 !important; color: #100e20 !important; border-color: #d0d0d0 !important; }
        .light-mode .btn-secondary:hover { background: #d0d0d0 !important; }
        .light-mode .sidebar-footer, .light-mode .admin-sidebar-footer { border-color: #d0d0d0 !important; }
        .light-mode .logout-btn:hover { background: #e8e8e8 !important; }
        .light-mode table th { background: #e8e8e8 !important; color: #100e20 !important; border-color: #d0d0d0 !important; }
        .light-mode table td { border-color: #d0d0d0 !important; color: #100e20 !important; }
        .light-mode table tr:hover { background: #e8e8e8 !important; }
        .light-mode .modal-overlay { background: rgba(0,0,0,0.3) !important; }
        .light-mode .modal, .light-mode .modal-content { background: #ffffff !important; border-color: #d0d0d0 !important; color: #100e20 !important; }
        .light-mode.light-mode .search-box, .light-mode .search-input { background: #e8e8e8 !important; border-color: #d0d0d0 !important; color: #100e20 !important; }
        .light-mode .tab, .light-mode .tab-btn { color: #555555 !important; }
        .light-mode .tab.active, .light-mode .tab-btn.active { color: #7c3aed !important; border-color: #7c3aed !important; }
        .light-mode .dropdown, .light-mode .dropdown-menu { background: #ffffff !important; border-color: #d0d0d0 !important; }
        .light-mode .dropdown-item:hover { background: #e8e8e8 !important; }
        .light-mode .toggle-switch { background: #d0d0d0 !important; }
        .light-mode .toggle-switch.active { background: #7c3aed !important; }
        .light-mode .tooltip { background: #100e20 !important; color: #ffffff !important; }
        .light-mode .progress-bar { background: #e8e8e8 !important; }
        .light-mode .empty-state { color: #555555 !important; }
        .light-mode .filter-bar, .light-mode .toolbar { background: #ffffff !important; border-color: #d0d0d0 !important; }
        .light-mode .chip { background: #e8e8e8 !important; color: #100e20 !important; }
        .light-mode pre, .light-mode code { background: #e8e8e8 !important; color: #100e20 !important; }
        .light-mode .status-badge { border-color: #d0d0d0 !important; }
        .light-mode ::selection { background: #7c3aed; color: #ffffff; }
        .light-mode ::-webkit-scrollbar-track { background: #f5f5f5; }
        .light-mode ::-webkit-scrollbar-thumb { background: #d0d0d0; }
        .light-mode ::-webkit-scrollbar-thumb:hover { background: #bbbbbb; }

/* Light Mode */
        html.light-mode { --bg-dark: #ede9fe; --bg-card: #ffffff; --bg-input: #f0ebe3; --bg-hover: #e8e4dc; --border: #d0d0d0; --text-primary: #100e20; --text-secondary: #5c5c5c; --text-muted: #8c8c8c; }
        html.light-mode .admin-sidebar { background: #ffffff !important; border-color: #d0d0d0 !important; }
        html.light-mode .admin-nav-item { color: #5c5c5c; }
        html.light-mode .admin-nav-item:hover { background: #f0ebe3; color: #100e20; }
        html.light-mode .admin-nav-item.active { background: rgba(139, 92, 246, 0.15); color: #7c3aed; }
        html.light-mode .admin-nav-section-title { color: #8c8c8c; }
        html.light-mode .admin-sidebar-footer { border-color: #d0d0d0; }
        html.light-mode .stat-card, html.light-mode .card, html.light-mode .table-card, html.light-mode .analytics-card { background: #ffffff; border-color: #d0d0d0; }
        html.light-mode .search-input, html.light-mode .filter-select { background: #ffffff; border-color: #d0d0d0; color: #100e20; }
        html.light-mode th { background: #f0ebe3; color: #8c8c8c; border-color: #d0d0d0; }
        html.light-mode td { border-color: #d0d0d0; color: #5c5c5c; }
        html.light-mode tr:hover { background: #f0ebe3; }
        html.light-mode .modal { background: #ffffff; }
        html.light-mode .modal-header { border-color: #d0d0d0; }
        html.light-mode .btn-secondary { background: #ffffff; border-color: #d0d0d0; color: #5c5c5c; }
        .admin-sidebar { width: 260px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 24px 16px; position: fixed; left: 0; top: 0; height: 100vh; overflow-y: auto; z-index: 99; display: flex; flex-direction: column; }
        .admin-sidebar-logo { font-size: 1.1rem; font-weight: 700; color: var(--admin, #8b5cf6); margin-bottom: 16px; }
        .admin-nav-section { margin-bottom: 24px; }
        .admin-nav-section-title { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; color: var(--text-muted, #888); padding: 0 12px; margin-bottom: 8px; letter-spacing: 0.5px; }
        .admin-nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; color: #8b85b0; text-decoration: none; font-size: 0.85rem; font-weight: 500; transition: all 0.2s; cursor: pointer; margin-bottom: 4px; }
        .admin-nav-item:hover { background: var(--bg-hover, #333); color: var(--text-primary, #ede9fe); }
        .admin-nav-item.active { background: rgba(139, 92, 246, 0.15); color: var(--admin, #8b5cf6); }
        .admin-nav-item svg { width: 18px; height: 18px; flex-shrink: 0; }
        .admin-sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border, #333); }
        .main-content { flex: 1; margin-left: 260px; }
            /* Mobile */
        .hamburger-menu { display: none; position: fixed; top: 20px; left: 20px; z-index: 100; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 8px; cursor: pointer; width: 40px; height: 40px; }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .admin-sidebar { width: 100%; height: auto; position: relative; left: auto; top: auto; border-right: none; border-bottom: 1px solid var(--border); padding: 12px; margin-bottom: 20px; }
            .main-content { margin-left: 0 !important; }
        }
    
        /* Sidebar actions (bell + theme toggle) */
        /* Sidebar layout fix */
        .admin-sidebar { display: flex; flex-direction: column; }
        .admin-sidebar nav { flex: 1; overflow-y: auto; }
</style>

<style>

/* ===== AURORA THEME â€” Glassmorphism Purple/Teal ===== */
/* Glass card effect */
.stat-card, .analytics-card, .table-card, .admin-card, .metric-card {
    background: rgba(24, 21, 48, 0.6) !important;
    backdrop-filter: blur(16px) !important;
    -webkit-backdrop-filter: blur(16px) !important;
    border: 1px solid rgba(139, 92, 246, 0.12) !important;
    border-radius: 16px !important;
}
.admin-sidebar {
    background: rgba(16, 14, 32, 0.85) !important;
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    border-right: 1px solid rgba(139, 92, 246, 0.1) !important;
}
.admin-nav-item {
    border-radius: 12px !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}
.admin-nav-item:hover {
    background: rgba(139, 92, 246, 0.08) !important;
    transform: translateX(4px);
}
.admin-nav-item.active {
    background: rgba(139, 92, 246, 0.15) !important;
    color: #8b5cf6 !important;
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.08);
}
.btn-primary, .btn {
    border-radius: 12px !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}
.btn-primary:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 8px 30px rgba(139, 92, 246, 0.3) !important;
}
input, textarea, select {
    border-radius: 12px !important;
    transition: all 0.25s ease !important;
}
input:focus, textarea:focus, select:focus {
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15), 0 0 30px rgba(139, 92, 246, 0.05) !important;
}
.modal {
    border-radius: 20px !important;
    background: rgba(24, 21, 48, 0.9) !important;
    backdrop-filter: blur(24px) !important;
    -webkit-backdrop-filter: blur(24px) !important;
    border: 1px solid rgba(139, 92, 246, 0.15) !important;
}
/* Gradient accents */
.brand-panel::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #8b5cf6, #14b8a6, transparent);
}
.header h1, .admin-sidebar-logo {
    background: linear-gradient(135deg, #8b5cf6, #14b8a6) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
}
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: rgba(16, 14, 32, 0.5); }
::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(139, 92, 246, 0.5); }
/* Status badges */
.role-badge, .status-badge { border-radius: 20px !important; }
/* Animated background pulse */
body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 30% 70%, rgba(139, 92, 246, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 70% 30%, rgba(20, 184, 166, 0.02) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
    animation: auroraPulse 20s ease-in-out infinite;
}
@keyframes auroraPulse {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(-5%, 5%) scale(1.02); }
    50% { transform: translate(5%, -5%) scale(0.98); }
    75% { transform: translate(-3%, -3%) scale(1.01); }
}

</style>
</head>
<body>
    <div class="layout">
            <aside class="admin-sidebar" id="adminSidebar">
        <div class="admin-sidebar-logo">FLEETCONNECT</div>
<nav id="sidebarNav"></nav>
        <div class="admin-sidebar-footer">
            <div style="padding: 12px; background: var(--bg-hover, #333); border-radius: 8px;">
                <div style="font-size: 0.8rem; font-weight: 600; color: var(--text-primary, #ede9fe); margin-bottom: 4px;" id="adminUserName">Rental User</div>
                <div class="admin-sidebar-role" style="font-size: 0.75rem; color: var(--text-secondary, #888);">Rental Account</div>
                <button onclick="logout()" style="margin-top: 8px; width: 100%; padding: 6px; background: transparent; border: 1px solid #333; color: #888; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.75rem; cursor: pointer; transition: all 0.2s;">Logout</button>
            </div>
        </div>
    </aside>

        <div class="main-content">
            <header class="header">
                <div>
                    <button class="mobile-toggle" onclick="document.querySelector('.admin-sidebar').classList.toggle('open')"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
                </div>
                <h1>Alert Settings</h1>
            </header>

            <div class="content">
                <div class="success-message" id="successMessage">âœ“ Settings saved successfully</div>

                <!-- Fuel Level Alert -->
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">â›½</div>
                        <div class="alert-info">
                            <div class="alert-title">Low Fuel Level Alert</div>
                            <div class="alert-description">Notify when equipment fuel level drops below threshold</div>
                        </div>
                        <label class="toggle-switch" id="toggleFuel" onclick="toggleAlert(this)">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                    <div class="config-section" id="fuelConfig" style="display:none;">
                        <div class="config-title">Configuration</div>
                        <div class="form-group">
                            <label>Fuel Level Threshold (%)</label>
                            <input type="number" id="fuelThreshold" min="5" max="50" value="25" placeholder="25">
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="fuelEmail" checked>
                                <label for="fuelEmail">Email</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fuelSms" checked>
                                <label for="fuelSms">SMS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fuelApp" checked>
                                <label for="fuelApp">In-App</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Maintenance Alert -->
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">ðŸ”§</div>
                        <div class="alert-info">
                            <div class="alert-title">Equipment Maintenance Alert</div>
                            <div class="alert-description">Notify before scheduled maintenance is due</div>
                        </div>
                        <label class="toggle-switch" id="toggleMaint" onclick="toggleAlert(this)">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                    <div class="config-section" id="maintConfig" style="display:none;">
                        <div class="config-title">Configuration</div>
                        <div class="form-group">
                            <label>Days Before Due</label>
                            <input type="number" id="maintDays" min="1" max="30" value="7" placeholder="7">
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="maintEmail" checked>
                                <label for="maintEmail">Email</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="maintSms" checked>
                                <label for="maintSms">SMS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="maintApp" checked>
                                <label for="maintApp">In-App</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contract Expiration Alert -->
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">ðŸ“…</div>
                        <div class="alert-info">
                            <div class="alert-title">Contract Expiration Alert</div>
                            <div class="alert-description">Notify before rental contract expires</div>
                        </div>
                        <label class="toggle-switch active" id="toggleContract" onclick="toggleAlert(this)">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                    <div class="config-section" id="contractConfig" style="">
                        <div class="config-title">Configuration</div>
                        <div class="form-group">
                            <label>Days Before Expiration</label>
                            <input type="number" id="contractDays" min="1" max="60" value="14" placeholder="14">
                        </div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="contractEmail" checked>
                                <label for="contractEmail">Email</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="contractSms">
                                <label for="contractSms">SMS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="contractApp" checked>
                                <label for="contractApp">In-App</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Job Status Change Alert -->
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">ðŸ“‹</div>
                        <div class="alert-info">
                            <div class="alert-title">Job Status Change Alert</div>
                            <div class="alert-description">Notify when work order status changes</div>
                        </div>
                        <label class="toggle-switch active" id="toggleStatus" onclick="toggleAlert(this)">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                    <div class="config-section" id="statusConfig" style="">
                        <div class="config-title">Configuration</div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="statusEmail" checked>
                                <label for="statusEmail">Email</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="statusSms">
                                <label for="statusSms">SMS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="statusApp" checked>
                                <label for="statusApp">In-App</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invoice Submitted Alert -->
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">ðŸ’°</div>
                        <div class="alert-info">
                            <div class="alert-title">Invoice Submitted Alert</div>
                            <div class="alert-description">Notify when new invoices are submitted</div>
                        </div>
                        <label class="toggle-switch active" id="toggleInvoice" onclick="toggleAlert(this)">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                    <div class="config-section" id="invoiceConfig" style="">
                        <div class="config-title">Configuration</div>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="invoiceEmail" checked>
                                <label for="invoiceEmail">Email</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="invoiceSms">
                                <label for="invoiceSms">SMS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="invoiceApp" checked>
                                <label for="invoiceApp">In-App</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    <button class="btn btn-secondary" onclick="sendTestAlert()">Send Test Alert</button>
                </div>
            </div>
        </div><!-- end main-content -->
    </div>

    <script src="supabase-client.js"></script>
    <script src="sidebar.js"></script>
    <script src="feature-flags.js"></script>
    <script>
        // Auth Check
        const currentUser = checkAuth(['rental', 'vendor', 'admin']);
        if (currentUser) {
            var _un = document.getElementById('adminUserName'); if(_un) _un.textContent = currentUser.name;
        }

        // Feature Flags
        FC_FLAGS.init('rental').then(() => {
            FC_FLAGS.gatePage('feature.alerts_settings', '/rental-dashboard.html');
        });

        // Navigation
        const icons = {
            grid: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>',
            bell: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>',
            settings: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>'
        };

        // Alert Management
        function toggleAlert(el) {
            const toggle = el.closest('.toggle-switch');
            toggle.classList.toggle('active');

            const cardId = toggle.id.replace('toggle', '').toLowerCase();
            const configId = cardId + 'Config';
            const config = document.getElementById(configId);
            if (config) {
                config.style.display = toggle.classList.contains('active') ? '' : 'none';
            }
        }

        async function saveSettings() {
            const settings = {
                fuel_alert: {
                    enabled: document.getElementById('toggleFuel').classList.contains('active'),
                    threshold: parseInt(document.getElementById('fuelThreshold').value) || 25,
                    channels: {
                        email: document.getElementById('fuelEmail').checked,
                        sms: document.getElementById('fuelSms').checked,
                        app: document.getElementById('fuelApp').checked
                    }
                },
                maintenance_alert: {
                    enabled: document.getElementById('toggleMaint').classList.contains('active'),
                    days_before: parseInt(document.getElementById('maintDays').value) || 7,
                    channels: {
                        email: document.getElementById('maintEmail').checked,
                        sms: document.getElementById('maintSms').checked,
                        app: document.getElementById('maintApp').checked
                    }
                },
                contract_alert: {
                    enabled: document.getElementById('toggleContract').classList.contains('active'),
                    days_before: parseInt(document.getElementById('contractDays').value) || 14,
                    channels: {
                        email: document.getElementById('contractEmail').checked,
                        sms: document.getElementById('contractSms').checked,
                        app: document.getElementById('contractApp').checked
                    }
                },
                status_alert: {
                    enabled: document.getElementById('toggleStatus').classList.contains('active'),
                    channels: {
                        email: document.getElementById('statusEmail').checked,
                        sms: document.getElementById('statusSms').checked,
                        app: document.getElementById('statusApp').checked
                    }
                },
                invoice_alert: {
                    enabled: document.getElementById('toggleInvoice').classList.contains('active'),
                    channels: {
                        email: document.getElementById('invoiceEmail').checked,
                        sms: document.getElementById('invoiceSms').checked,
                        app: document.getElementById('invoiceApp').checked
                    }
                }
            };

            try {
                localStorage.setItem('alert_settings_' + currentUser.id, JSON.stringify(settings));
                showSuccessMessage();
            } catch (err) {
                alert('Error saving settings: ' + err.message);
            }
        }

        async function sendTestAlert() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Sending...';

            try {
                // Simulate sending test notification
                await new Promise(r => setTimeout(r, 1500));
                alert('Test alert sent! Check your email and in-app notifications.');
                btn.disabled = false;
                btn.textContent = 'Send Test Alert';
            } catch (err) {
                alert('Error: ' + err.message);
                btn.disabled = false;
                btn.textContent = 'Send Test Alert';
            }
        }

        function showSuccessMessage() {
            const msg = document.getElementById('successMessage');
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
        }

        // Load settings on page load
        function loadSettings() {
            try {
                const saved = localStorage.getItem('alert_settings_' + currentUser.id);
                if (!saved) return;

                const settings = JSON.parse(saved);

                // Fuel Alert
                if (settings.fuel_alert) {
                    var _togg = document.getElementById('toggleFuel'); if(_togg) _togg.classList.toggle('active', settings.fuel_alert.enabled);
                    var _fuel = document.getElementById('fuelConfig'); if(_fuel) _fuel.style.display = settings.fuel_alert.enabled ? '' : 'none';
                    document.getElementById('fuelThreshold').value = settings.fuel_alert.threshold || 25;
                    document.getElementById('fuelEmail').checked = settings.fuel_alert.channels?.email ?? true;
                    document.getElementById('fuelSms').checked = settings.fuel_alert.channels?.sms ?? true;
                    document.getElementById('fuelApp').checked = settings.fuel_alert.channels?.app ?? true;
                }

                // Maintenance Alert
                if (settings.maintenance_alert) {
                    var _togg = document.getElementById('toggleMaint'); if(_togg) _togg.classList.toggle('active', settings.maintenance_alert.enabled);
                    var _main = document.getElementById('maintConfig'); if(_main) _main.style.display = settings.maintenance_alert.enabled ? '' : 'none';
                    document.getElementById('maintDays').value = settings.maintenance_alert.days_before || 7;
                    document.getElementById('maintEmail').checked = settings.maintenance_alert.channels?.email ?? true;
                    document.getElementById('maintSms').checked = settings.maintenance_alert.channels?.sms ?? true;
                    document.getElementById('maintApp').checked = settings.maintenance_alert.channels?.app ?? true;
                }

                // Contract Alert
                if (settings.contract_alert) {
                    var _togg = document.getElementById('toggleContract'); if(_togg) _togg.classList.toggle('active', settings.contract_alert.enabled);
                    var _cont = document.getElementById('contractConfig'); if(_cont) _cont.style.display = settings.contract_alert.enabled ? '' : 'none';
                    document.getElementById('contractDays').value = settings.contract_alert.days_before || 14;
                    document.getElementById('contractEmail').checked = settings.contract_alert.channels?.email ?? true;
                    document.getElementById('contractSms').checked = settings.contract_alert.channels?.sms ?? true;
                    document.getElementById('contractApp').checked = settings.contract_alert.channels?.app ?? true;
                }

                // Status Alert
                if (settings.status_alert) {
                    var _togg = document.getElementById('toggleStatus'); if(_togg) _togg.classList.toggle('active', settings.status_alert.enabled);
                    var _stat = document.getElementById('statusConfig'); if(_stat) _stat.style.display = settings.status_alert.enabled ? '' : 'none';
                    document.getElementById('statusEmail').checked = settings.status_alert.channels?.email ?? true;
                    document.getElementById('statusSms').checked = settings.status_alert.channels?.sms ?? true;
                    document.getElementById('statusApp').checked = settings.status_alert.channels?.app ?? true;
                }

                // Invoice Alert
                if (settings.invoice_alert) {
                    var _togg = document.getElementById('toggleInvoice'); if(_togg) _togg.classList.toggle('active', settings.invoice_alert.enabled);
                    var _invo = document.getElementById('invoiceConfig'); if(_invo) _invo.style.display = settings.invoice_alert.enabled ? '' : 'none';
                    document.getElementById('invoiceEmail').checked = settings.invoice_alert.channels?.email ?? true;
                    document.getElementById('invoiceSms').checked = settings.invoice_alert.channels?.sms ?? true;
                    document.getElementById('invoiceApp').checked = settings.invoice_alert.channels?.app ?? true;
                }
            } catch (err) {
                console.error('Error loading settings:', err);
            }
        }

        loadSettings();
    </script>
    
<script src="hamburger-menu.js"></script>
<script src="global-search.js"></script>
<script src="notification-center.js"></script>
    <script src="realtime.js"></script>
</body>
</html>
